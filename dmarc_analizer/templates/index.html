{% extends 'base.html' %}
{% block content %}
<div class="row g-3">
  <div class="col-12 col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title">Tráfico por dominio (últimos 30 días)</h5>
        {% if domain_summary %}
          <ul class="list-group list-group-flush">
            {% for domain, total in domain_summary %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ domain }}
                <span class="badge text-bg-primary rounded-pill">{{ total }}</span>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">Aún no hay reportes cargados.</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title">Disposiciones</h5>
        {% if disposition_summary %}
          <ul class="list-group list-group-flush">
            {% for disposition, total in disposition_summary %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ disposition or 'desconocida' }}
                <span class="badge text-bg-secondary rounded-pill">{{ total }}</span>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted">Carga un informe para empezar.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="row g-3 mt-3">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Reportes recientes</h5>
        {% if latest_reports %}
          <div class="table-responsive">
            <table class="table table-striped align-middle">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Dominio</th>
                  <th>Fecha</th>
                  <th>Emisor</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {% for report in latest_reports %}
                  <tr>
                    <td>{{ report.report_id }}</td>
                    <td>{{ report.domain }}</td>
                    <td>{{ report.date_range_start.date() }} - {{ report.date_range_end.date() }}</td>
                    <td>{{ report.org_name or 'desconocido' }}</td>
                    <td>
                      <a class="btn btn-sm btn-outline-primary" href="{{ url_for('web.report_detail', report_id=report.id) }}">Ver detalle</a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-muted">No hay reportes recientes.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
